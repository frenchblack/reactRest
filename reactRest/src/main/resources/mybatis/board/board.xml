<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.react.mapper.board.BoardMapper">
	<select id="getBoardList" resultType="BoardVO">
		SELECT A.BOARD_NO AS BOARD_NO
			  , A.TITLE AS TITLE
			  , A.CONTENT AS CONTENT
			  , A.WRITER AS WRITER
			  , A.WRITE_DATE AS WRITE_DATE
			  , A.LIKE_CNT AS LIKE_CNT
			  , A.VIEW_CNT AS VIEW_CNT
			  , A.IS_DEL AS IS_DEL
			  , A.CATEGORY_CD AS CATEGORY_CD
			  , B.CATEGORY_NM AS CATEGORY_NM
			  , A.MENU_CD AS MENU_CD
		  FROM BOARD A
		  LEFT OUTER JOIN CATEGORY B
		    ON A.CATEGORY_CD = B.CATEGORY_CD
		   WHERE A.IS_DEL = FALSE
     		 AND A.MENU_CD =#{menu_cd}
		  <if test="keyword != null and keyword != ''">
		    <choose>
		      <when test="type == 'title'">
		        AND A.TITLE LIKE CONCAT('%', #{keyword}, '%')
		      </when>
		      <when test="type == 'writer'">
		        AND A.WRITER LIKE CONCAT('%', #{keyword}, '%')
		      </when>
		      <when test="type == 'titleContent'">
		        AND (A.TITLE LIKE CONCAT('%', #{keyword}, '%') OR A.CONTENT LIKE CONCAT('%', #{keyword}, '%'))
		      </when>
		    </choose>
		  </if>   
		  <if test="category != null and category != ''">
		  	<choose>
  				<when test="subCategory != null and subCategory != ''">
		  			AND A.CATEGORY_CD = #{subCategory}
		  		</when>
		  		<otherwise>
		  			AND B.P_CD = #{category}
		  		</otherwise>
		  	</choose>
		  </if>
		<if test="period != null and period != '' and period != ''">
		  <choose>
		    <when test="period == '1d'">
		      AND A.WRITE_DATE >= NOW() - INTERVAL 1 DAY
		    </when>
		    <when test="period == '7d'">
		      AND A.WRITE_DATE >= NOW() - INTERVAL 7 DAY
		    </when>
		    <when test="period == '1m'">
		      AND A.WRITE_DATE >= NOW() - INTERVAL 1 MONTH
		    </when>
		  </choose>
		</if>
		<choose>
		  <when test="sort == 'popular'">
		 ORDER BY A.VIEW_CNT DESC
		 		, A.WRITE_DATE DESC
	 	  </when>
		  <when test="sort == 'vote'">
		 ORDER BY A.LIKE_CNT DESC
		        , A.WRITE_DATE DESC
		  </when>
		  <otherwise>
		 ORDER BY A.WRITE_DATE DESC
		 		  , A.BOARD_NO DESC
		  </otherwise>
		</choose>
		 LIMIT #{size} OFFSET #{offset};
	</select>
	<insert id="postBoard" parameterType="BoardVO" useGeneratedKeys="true" keyProperty="board_no">
	  INSERT INTO BOARD (
	    TITLE,
	    CONTENT,
	    WRITER,
	    CATEGORY_CD,
	    MENU_CD
	  ) VALUES (
	    #{title},
	    #{content},
	    #{writer},
	    #{category_cd},
	    #{menu_cd}
	  )
	</insert>
</mapper>
